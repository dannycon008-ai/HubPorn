<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Plataforma de Videos</title>
  <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&display=swap" rel="stylesheet">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:"Segoe UI", Tahoma, sans-serif; background:#121212; color:#fff; }

    header { position:fixed; top:0; left:0; right:0; background:#1f1f1f;
      display:flex; justify-content:space-between; align-items:center;
      padding:12px 18px; z-index:100; }
    .title{ font-family:"Archivo Black", sans-serif; font-size:2rem;
      background:linear-gradient(to right, #ff4444 50%, #ffffff 50%);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; }

    #searchBar {
      background:#2a2a2a; border:none; padding:8px 12px; border-radius:6px; color:white;
      width:200px;
    }

    main{ margin-top:74px; display:flex; }
    .sidebar{ width:240px; background:#1f1f1f; padding:14px; height:calc(100vh - 74px);
      position:fixed; top:74px; left:0; overflow-y:auto; border-right:1px solid #222; }
    .content{ margin-left:240px; flex:1; padding:20px; }

    /* üìÇ Carpetas (grid con scroll, hover animado) */
    .folder-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 15px;
      max-height: calc(100vh - 100px);
      overflow-y: auto;
      padding: 10px;
    }
    .folder-card {
      background:#1b1b1b; border:1px solid #242424; border-radius:10px;
      padding:8px; text-align:center; cursor:pointer;
      transition:transform .2s, box-shadow .2s;
    }
    .folder-card:hover {
      transform: scale(1.05);
      box-shadow: 0 0 10px #ff4444;
    }
    .folder-card video { width:100%; height:90px; object-fit:cover; border-radius:6px; }
    .folder-card h3 { margin-top:6px; font-size:0.9rem; color:#ff4444; font-family:"Archivo Black", sans-serif; }

    /* üé¨ Videos dentro de carpeta */
    .video-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(160px,1fr)); gap:12px; padding:10px; }
    .video-card { background:#1b1b1b; border:1px solid #242424; border-radius:10px; padding:6px; transition:.2s; cursor:pointer; }
    .video-card:hover { transform: scale(1.05); box-shadow: 0 0 10px #ff4444; }
    .video-card video { width:100%; height:90px; object-fit:cover; border-radius:6px; }

    /* üì∫ Video centrado con anuncios */
    .video-wrapper { display:flex; justify-content:center; align-items:flex-start; gap:15px; margin-top:15px; }
    .video-player video#videoPlayer { width:80%; max-width:600px; border-radius:12px; background:#000; }
    .side-ad { width:120px; height:600px; background:#222; border-radius:8px; overflow:hidden; }
    .side-ad img { width:100%; height:100%; object-fit:cover; }

    /* Banner publicitario */
    #videoBanner { margin:10px auto; text-align:center; }

    /* Responsive */
    @media (max-width:900px){
      .sidebar { width:100%; position:relative; height:auto; border-right:none; }
      .content { margin-left:0; }
      .video-wrapper { flex-direction:column; align-items:center; }
      .side-ad { width:100%; height:120px; }
      .video-player video#videoPlayer { width:100%; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <h1 class="title">HubPorn</h1>
    <input id="searchBar" type="text" placeholder="Buscar carpeta...">
  </header>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar"></aside>

  <!-- Contenido -->
  <main class="content">
    <div id="videoSection"><p>Cargando carpetas...</p></div>
  </main>

  <script>
  // Configuraci√≥n Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCvQcDPSF9u1mr2RNQClhMEQ1yDZiuLM-M",
    authDomain: "minitinder-f6314.firebaseapp.com",
    projectId: "minitinder-f6314",
    storageBucket: "minitinder-f6314.appspot.com",
    messagingSenderId: "659347167496",
    appId: "1:659347167496:web:a4e76f562ffba1c4bdf4bd",
    measurementId: "G-L0E0Y4ZLK6"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const sidebar = document.getElementById("sidebar");
  const videoSection = document.getElementById("videoSection");
  const searchBar = document.getElementById("searchBar");

  // ‚úÖ Renderizar carpetas en el sidebar
  async function renderSidebar(filter=""){
    sidebar.innerHTML = "";
    const snapshot = await db.collection("folders").get();
    snapshot.forEach(doc => {
      const folder = doc.id;
      if(filter && !folder.toLowerCase().includes(filter.toLowerCase())) return;
      const item = document.createElement("div");
      item.className = "folder";
      item.innerHTML = `<h3>${folder}</h3>`;
      item.onclick = () => showFolder(folder);
      sidebar.appendChild(item);
    });
  }

  // ‚úÖ Buscador en vivo
  searchBar.addEventListener("input", (e) => renderSidebar(e.target.value));

  // ‚úÖ Vista previa inicial con TODAS las carpetas
  async function renderPresentation(){
    const snapshot = await db.collection("folders").get();
    if (snapshot.empty){
      videoSection.innerHTML = "<p>No hay carpetas creadas todav√≠a</p>";
      return;
    }

    let grid = "";
    snapshot.forEach(doc => {
      const folder = doc.id;
      const data = doc.data();
      const videos = data.videos || [];
      const preview = videos.length > 0 ? videos[0].url : "";

      grid += `
        <div class="folder-card" onclick="showFolder('${folder}')">
          ${preview 
            ? `<video class="preview" src="${preview}" muted preload="metadata"></video>`
            : `<div style="height:90px;display:flex;align-items:center;justify-content:center;background:#222;color:#aaa;">Sin videos</div>`}
          <h3>${folder}</h3>
        </div>
      `;
    });

    videoSection.innerHTML = `<h2 style="margin-bottom:12px;">üìÇ Todas las carpetas</h2>
      <div class="folder-grid">${grid}</div>`;
  }

  // ‚úÖ Mostrar videos de una carpeta
  async function showFolder(folder){
    const docSnap = await db.collection("folders").doc(folder).get();
    if (!docSnap.exists){
      videoSection.innerHTML = `<h2>${folder}</h2><p>No hay videos aqu√≠ todav√≠a.</p>`;
      return;
    }
    const data = docSnap.data();
    const grid = data.videos.map((v, idx) => `
      <div class="video-card" onclick="playVideo('${folder}', ${idx})">
        <video class="preview" src="${v.url}" muted preload="metadata"></video>
        <div>${v.views} vistas</div>
      </div>
    `).join("");
    videoSection.innerHTML = `<h2>${folder}</h2><div class="video-grid">${grid}</div>`;
  }

  /* -------- REPRODUCIR VIDEO -------- */
  async function playVideo(folder, idx){
    const folderRef = db.collection("folders").doc(folder);
    const docSnap = await folderRef.get();
    if (!docSnap.exists) return;

    const data = docSnap.data();
    const v = data.videos[idx];

    // üìà Aumentar vistas
    v.views++;
    data.videos[idx] = v;
    await folderRef.update({ videos: data.videos });

    // üé¨ Renderizar video centrado con anuncios y banner
    videoSection.innerHTML = `
      <div id="videoBanner">
        <script type="text/javascript">
         atOptions = { 'key' : 'de13ddc2442e4144561bcec2fa1af174','format' : 'iframe','height' : 60,'width' : 468,'params' : {} };
        </script>
        <script type="text/javascript" src="//leaklitre.com/de13ddc2442e4144561bcec2fa1af174/invoke.js"></script>
      </div>
      <div class="video-wrapper">
        <div class="side-ad"><img src="https://via.placeholder.com/120x600?text=Ad+Izquierda"></div>
        <div class="video-player">
          <video id="videoPlayer" controls autoplay controlslist="nodownload" disablePictureInPicture>
            <source src="${v.url}" type="video/mp4">
          </video>
          <p>üëÅÔ∏è ${v.views} vistas</p>
        </div>
        <div class="side-ad"><img src="https://via.placeholder.com/120x600?text=Ad+Derecha"></div>
      </div>
    `;
  }

  renderSidebar();
  renderPresentation(); // üëà carga vista previa al inicio
  </script>
</body>
</html>
