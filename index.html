<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HubPorn</title>

  <!-- Fuente del título -->
  <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&display=swap" rel="stylesheet">

  <!-- Firebase (compat) -->
  <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <style>
    :root{
      --bg:#0d0d0d;
      --panel:#141414;
      --card:#1b1b1b;
      --border:#2a2a2a;
      --txt:#ffffff;
      --accent:#ff4444;
    }
    *{margin:0; padding:0; box-sizing:border-box}
    body{background:var(--bg); color:var(--txt); font-family:"Segoe UI", Tahoma, sans-serif;}

    /* Header */
    header{
      position:sticky; top:0; z-index:100;
      display:flex; align-items:center; justify-content:center;
      padding:14px 20px;
      background:linear-gradient(90deg,#161616,#0f0f0f);
      border-bottom:1px solid var(--border);
      box-shadow:0 4px 14px rgba(0,0,0,.35);
      cursor:pointer;
    }
    .title{
      font-family:"Archivo Black", sans-serif;
      font-size:2rem; line-height:1;
      background:linear-gradient(90deg, var(--accent), #ffa045);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
      letter-spacing:.5px;
      user-select:none;
      transition:transform .2s;
    }
    .title:hover{ transform:scale(1.05); }

    /* Layout 3 columnas */
    .layout{
      display:grid;
      grid-template-columns: 200px 1fr 220px;
      gap:15px;
      max-width:1400px;
      margin:20px auto;
      padding:0 10px;
    }

    .ads-left, .previews-right{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:10px;
      padding:10px;
      min-height:200px;
    }

    .top-banner{
      font-family:"Archivo Black", sans-serif;
      font-size:1.3rem;
      text-align:center;
      background:linear-gradient(90deg, #ff4444, #ffa045);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      margin-bottom:14px;
    }

    /* Grid Netflix */
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(160px, 1fr));
      gap:18px;
    }
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:12px;
      overflow:hidden;
      cursor:pointer;
      transition:transform .22s ease, box-shadow .22s ease, border-color .22s ease;
    }
    .card:hover{
      transform:translateY(-6px) scale(1.04);
      border-color:#3a3a3a;
      box-shadow:0 12px 26px rgba(0,0,0,.45), 0 0 18px rgba(255,68,68,.25);
    }
    .card-video{ width:100%; height:100px; object-fit:cover; display:block; background:#000; }
    .card-title{ text-align:center; font-size:.9rem; padding:8px; }

    /* Previews derecha */
    .preview-item{ margin-bottom:12px; cursor:pointer; }
    .preview-item video{ width:100%; height:100px; object-fit:cover; border-radius:8px; }
    .preview-title{ font-size:.8rem; margin-top:4px; text-align:center; color:#ccc; }

    /* Video player */
    .video-player{ text-align:center; }
    .video-player video{
      width:300px; height:350px; border-radius:10px; background:#000;
      
      /* 📱 En móviles (Android/iOS) */
@media (max-width: 600px) {
  .video-player video {
    width: 300px;   /* ancho fijo */
    height: 350px;  /* alto fijo */
  }
}

      
    }
    #adContainer{ margin-top:12px; text-align:center; }
    #adContainer iframe{ max-width:100%; height:auto; }

    /* Reacciones */
    .reactions{
      margin:12px 0;
      display:flex;
      justify-content:center;
      gap:12px;
    }
    .reactions button{
      background:#222;
      border:none;
      padding:8px 14px;
      border-radius:20px;
      color:#fff;
      cursor:pointer;
      transition:.2s;
    }
    .reactions button.active{ background:var(--accent); }
    .reactions button:hover{ transform:scale(1.05); }

    /* Responsive */
    @media(max-width: 900px){
      .layout{ grid-template-columns:1fr; }
      .ads-left, .previews-right{ display:none; }
      .video-player video{ width:100%; height:auto; }
    }
    /* 🔹 PC: anuncio lateral */
.ad-desktop {
  display: block;
  width: 100%;
  border-radius: 8px;
  cursor: pointer;
}
.ad-mobile-wrapper {
  display: none; /* oculto en PC */
}

/* 🔹 SOLO en móviles/tablets */
@media (max-width: 900px) {
  .ads-left { display: none; } /* ocultamos el lateral */
  .ad-mobile-wrapper { 
    display: flex; 
    justify-content: center; 
    margin: 10px 0;
  }
  .ad-mobile {
    width: 320px;   /* horizontal */
    height: 100px;  /* proporción banner */
    object-fit: cover;
    border-radius: 8px;
    cursor: pointer;
  }
}

  </style>
</head>
<body>
  <!-- Header -->
  <header onclick="goHome()">
    <h1 class="title">HubPorn</h1>
  </header>

  <div class="layout">
  <!-- Ads izquierda (solo PC) -->
<aside class="ads-left">
  <div class="top-banner">Publicidad</div>
  <img src="https://tuservidor.com/publicidad.jpg" 
       alt="Publicidad"
       class="ad-desktop"
       onclick="showAd('https://s11.erome.com/2497/nZMW9sgy/ZhsREn5s.jpeg?v=1714070792')">
</aside>

<!-- Ads superior horizontal (solo móvil) -->
<div class="ad-mobile-wrapper">
  <img src="https://tuservidor.com/publicidad.jpg" 
       alt="Publicidad"
       class="ad-mobile"
       onclick="showAd('https://s11.erome.com/2497/nZMW9sgy/GEJPGxVJ.jpeg?v=1714070791')">
</div>


    <!-- Centro -->
    <main>
      <h2 class="top-banner" id="sectionTitle">📂 Todas las carpetas</h2>
      <div id="folderGrid" class="grid"></div>
      <div id="videoSection"></div>
    </main>

    <!-- Previews derecha -->
    <aside class="previews-right">
      <div class="top-banner">🎬 Previews</div>
      <div id="previewList"></div>
    </aside>
  </div>

  <script>
  window.addEventListener('DOMContentLoaded', () => {
    // ---- Firebase ----
    const firebaseConfig = {
      apiKey: "AIzaSyCvQcDPSF9u1mr2RNQClhMEQ1yDZiuLM-M",
      authDomain: "minitinder-f6314.firebaseapp.com",
      projectId: "minitinder-f6314",
      storageBucket: "minitinder-f6314.appspot.com",
      messagingSenderId: "659347167496",
      appId: "1:659347167496:web:a4e76f562ffba1c4bdf4bd"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ---- Estado de vista ----
    const state = { view: 'home', folder: null }; // 'home' | 'folder' | 'player'

    // ---- DOM ----
    const folderGrid   = document.getElementById("folderGrid");
    const previewList  = document.getElementById("previewList");
    const videoSection = document.getElementById("videoSection");
    const sectionTitle = document.getElementById("sectionTitle");

    // Utilidad: tamaño de banner inferior según pantalla
    function pickBannerSize(){
      const w = window.innerWidth;
      if (w <= 480) return {width:320, height:50};   // móvil
      if (w <= 1024) return {width:468, height:60};  // tablet/mediano
      return {width:468, height:60};                 // desktop (ajústalo si tu red soporta 728x90)
    }

    // Inyectar banner inferior (NO usar innerHTML con <script>)
    function injectBottomBanner(containerId){
      const container = document.getElementById(containerId);
      if (!container) return;
      container.innerHTML = ""; // limpia

      const sz = pickBannerSize();
      const s1 = document.createElement("script");
      s1.type = "text/javascript";
      s1.text = `
        atOptions = {
          'key' : 'de13ddc2442e4144561bcec2fa1af174',
          'format' : 'iframe',
          'height' : ${sz.height},
          'width'  : ${sz.width},
          'params' : {}
        };
      `;
      const s2 = document.createElement("script");
      s2.type = "text/javascript";
      s2.src  = "//leaklitre.com/de13ddc2442e4144561bcec2fa1af174/invoke.js";

      container.appendChild(s1);
      container.appendChild(s2);
    }

    // ---- Render Home (todas las carpetas) ----
    function renderHome(docs){
      state.view = 'home';
      state.folder = null;
      sectionTitle.textContent = "📂 Todas las carpetas";
      videoSection.innerHTML = "";
      folderGrid.style.display = "grid";
      folderGrid.innerHTML = docs.map(doc=>{
        const folder = doc.id;
        const data = doc.data(); const videos = data.videos||[];
        const preview = videos[0]?.url;
        return `
          <div class="card" onclick="openFolder('${folder}')">
            ${preview ? `<video class="card-video" src="${preview}" muted playsinline></video>` : `<div style="height:100px;background:#222"></div>`}
            <div class="card-title">${folder}</div>
          </div>`;
      }).join("");
    }

    // ---- Render Previews derecha ----
    function renderPreviews(docs){
      let previews = [];
      docs.forEach(doc=>{
        const data = doc.data(); const videos = data.videos||[];
        videos.slice(0,1).forEach((v,idx)=>{
          previews.push({folder:doc.id, url:v.url, idx});
        });
      });
      previewList.innerHTML = previews.map(p=>`
        <div class="preview-item" onclick="playVideo('${p.folder}', ${p.idx})">
          <video src="${p.url}" muted playsinline></video>
          <div class="preview-title">${p.folder}</div>
        </div>`).join("");
    }

    // ---- Abrir carpeta (solo la seleccionada) ----
    async function openFolder(folder){
      const snap = await db.collection("folders").doc(folder).get();
      if (!snap.exists){ 
        sectionTitle.textContent = folder;
        folderGrid.innerHTML = "";
        videoSection.innerHTML = "<p>No hay videos</p>"; 
        return; 
      }
      state.view = 'folder';
      state.folder = folder;
      sectionTitle.textContent = folder;

      const data = snap.data();
      // Ocultar la grilla inicial (para que "desaparezcan" las demás carpetas)
      folderGrid.style.display = "none";
      // Mostrar solo la carpeta seleccionada
      videoSection.innerHTML = `
        <div class="grid">
          ${data.videos.map((v,idx)=>`
            <div class="card" onclick="playVideo('${folder}', ${idx})">
              <video class="card-video" src="${v.url}" muted playsinline></video>
              <div class="card-title">Video ${idx+1}</div>
            </div>`).join("")}
        </div>
      `;
    }

    // ---- Reproducir video ----
    async function playVideo(folder, idx){
      const ref = db.collection("folders").doc(folder);
      const snap = await ref.get();
      if (!snap.exists) return;

      const data = snap.data();
      const v = data.videos[idx];

      // Aumentar vistas
      v.views = (v.views||0) + 1;
      data.videos[idx] = v;
      await ref.update({ videos: data.videos });

      state.view = 'player';
      state.folder = folder;
      sectionTitle.textContent = `▶ ${folder}`;
      folderGrid.style.display = "none";

      videoSection.innerHTML = `
        <div class="video-player">
          <video id="videoPlayer" controls autoplay width="300" height="350">
            <source src="${v.url}" type="video/mp4">
          </video>
          <p>👁️ ${v.views} vistas</p>

          <div class="reactions">
            <button id="likeBtn"    onclick="toggleReaction('${folder}', ${idx}, 'like')">👍 (<span id="likeCount">${v.reactions?.like||0}</span>)</button>
            <button id="dislikeBtn" onclick="toggleReaction('${folder}', ${idx}, 'dislike')">👎 (<span id="dislikeCount">${v.reactions?.dislike||0}</span>)</button>
          </div>

          <!-- Banner inferior -->
          <div id="adContainer"></div>
        </div>
      `;

      // Mostrar banner en los 3 momentos
      const player = document.getElementById("videoPlayer");
      let adsShown = { start:false, mid:false, end:false };

      player.addEventListener("play", ()=>{
        if(!adsShown.start){ adsShown.start = true; injectBottomBanner("adContainer"); }
      });

      player.addEventListener("timeupdate", ()=>{
        if(player.currentTime >= 50 && !adsShown.mid){
          adsShown.mid = true; injectBottomBanner("adContainer");
        }
      });

      player.addEventListener("ended", ()=>{
        if(!adsShown.end){
          adsShown.end = true; injectBottomBanner("adContainer");
        }
      });

      // Pintar estado de reacción (si existe)
      const userReaction = v.userReaction || null;
      document.getElementById("likeBtn")   .classList.toggle("active", userReaction === 'like');
      document.getElementById("dislikeBtn").classList.toggle("active", userReaction === 'dislike');
    }

    // ---- Toggle reacciones (una sola activa) ----
    async function toggleReaction(folder, idx, type){
      const ref = db.collection("folders").doc(folder);
      const snap = await ref.get();
      if (!snap.exists) return;

      const data = snap.data();
      const v = data.videos[idx];

      // init
      v.reactions = v.reactions || {like:0, dislike:0};
      v.userReaction = v.userReaction || null;

      if (v.userReaction === type){
        // desmarcar
        v.reactions[type] = Math.max(0, (v.reactions[type]||0) - 1);
        v.userReaction = null;
      } else {
        // cambiar a la nueva y restar la anterior si había
        if (v.userReaction){
          v.reactions[v.userReaction] = Math.max(0, (v.reactions[v.userReaction]||0) - 1);
        }
        v.reactions[type] = (v.reactions[type]||0) + 1;
        v.userReaction = type;
      }

      data.videos[idx] = v;
      await ref.update({ videos: data.videos });

      // refrescar contadores y estilos sin recargar todo
      const likeCount    = document.getElementById("likeCount");
      const dislikeCount = document.getElementById("dislikeCount");
      if (likeCount)    likeCount.textContent    = v.reactions.like;
      if (dislikeCount) dislikeCount.textContent = v.reactions.dislike;

      const likeBtn    = document.getElementById("likeBtn");
      const dislikeBtn = document.getElementById("dislikeBtn");
      if (likeBtn)    likeBtn.classList.toggle("active", v.userReaction==='like');
      if (dislikeBtn) dislikeBtn.classList.toggle("active", v.userReaction==='dislike');
    }

    // ---- Volver al inicio ----
    function goHome(){
      // re-render con los datos más recientes
      db.collection("folders").get().then(snap => {
        renderHome(snap.docs);
      });
    }

    // Exponer funciones al scope global (para los onclick)
    window.openFolder     = openFolder;
    window.playVideo      = playVideo;
    window.toggleReaction = toggleReaction;
    window.goHome         = goHome;

    // Suscripción a cambios (solo actualiza home/previews si estamos en home)
    db.collection("folders").onSnapshot(snap=>{
      // Previews siempre se actualizan
      renderPreviews(snap.docs);
      // Si estamos en home, también actualizar grilla
      if (state.view === 'home'){
        renderHome(snap.docs);
      }
    });

    // Render inicial
    db.collection("folders").get().then(snap=>renderHome(snap.docs));
  });
  </script>
</body>
</html>
