<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HubPorn</title>

  <!-- Fuentes -->
  <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=Poppins:wght@500;700&display=swap" rel="stylesheet">

  <!-- Firebase -->
  <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <style>
    :root {
      --bg:#0d0d0d;
      --panel:#141414;
      --card:#1b1b1b;
      --border:#2a2a2a;
      --txt:#ffffff;
      --accent:#ff4444;
    }
    * {margin:0; padding:0; box-sizing:border-box}
    body {background:var(--bg); color:var(--txt); font-family:'Poppins', sans-serif;}

    header {
      position:sticky; top:0; z-index:100;
      display:flex; justify-content:center; align-items:center;
      padding:14px 20px;
      background:linear-gradient(90deg,#161616,#0f0f0f);
      border-bottom:1px solid var(--border);
      box-shadow:0 4px 14px rgba(0,0,0,.35);
      cursor:pointer;
    }
    .title {
      font-family:"Archivo Black", sans-serif;
      font-size:2rem;
      background:linear-gradient(90deg, var(--accent), #ffa045);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      transition:.2s;
    }
    .title:hover {transform:scale(1.05);}

    .layout {
      display:grid;
      grid-template-columns:200px 1fr 220px;
      gap:15px;
      max-width:1400px;
      margin:20px auto;
      padding:0 10px;
    }
    .ads-left, .previews-right {
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:10px;
      padding:10px;
    }

    .top-banner {
      font-family:"Archivo Black", sans-serif;
      font-size:1.3rem;
      text-align:center;
      background:linear-gradient(90deg, #ff4444, #ffa045);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      margin-bottom:14px;
    }

    .grid {
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(180px, 1fr));
      gap:16px;
    }
    .card {
      background:var(--card);
      border-radius:12px;
      overflow:hidden;
      cursor:pointer;
      transition:transform .25s ease, box-shadow .25s ease;
      box-shadow:0 4px 12px rgba(0,0,0,.3);
    }
    .card:hover {transform:scale(1.05);}
    .card-thumb {
      width:100%;
      aspect-ratio:1/1;     /* üîπ miniaturas cuadradas */
      object-fit:cover;
      background:#000;
      display:block;
    }
    .card-title {
      font-size:0.9rem;
      font-weight:600;
      text-align:center;
      padding:8px;
    }

    .preview-item {margin-bottom:12px; cursor:pointer;}
    .preview-item img {
      width:100%; aspect-ratio:1/1; object-fit:cover;
      border-radius:8px;
      display:block;
    }
    .preview-title {font-size:.85rem; margin-top:4px; text-align:center; color:#ccc;}

    .video-player {text-align:center;}
    .video-player video {
      width:100%;
      max-width:480px;
      aspect-ratio:1/1;     /* üîπ relaci√≥n 1:1 */
      border-radius:10px; background:#000;
    }
    #adContainer {margin-top:12px; text-align:center;}

    /* SOLO mostrar ‚ÄúLos m√°s vistos‚Äù en m√≥vil */
    .most-viewed-mobile {
      display:none;
      margin-top:20px;
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:10px;
      padding:10px;
    }
    .most-viewed-mobile h3 {
      text-align:center; color:var(--accent); margin-bottom:10px;
    }
    .most-viewed-mobile .mv-item {margin-bottom:10px; cursor:pointer;}
    .most-viewed-mobile .mv-item img {
      width:100%; aspect-ratio:1/1; object-fit:cover; border-radius:8px;
    }
    .most-viewed-mobile .mv-title {font-size:.8rem; text-align:center; color:#ccc;}

    @media(max-width:900px){
      .layout {grid-template-columns:1fr;}
      .ads-left, .previews-right {display:none;}
      .ads-mobile {display:block;}
      .most-viewed-mobile {display:block;} /* üîπ solo aparece en m√≥vil */
    }
  </style>
</head>
<body>
  <header onclick="goHome()"><h1 class="title">HubPorn</h1></header>

  <div class="layout">
    <main>
      <h2 class="top-banner" id="sectionTitle">VIDEOS GRATIS</h2>
      <div id="folderGrid" class="grid"></div>
      <div id="videoSection"></div>
      <div id="mostViewedMobile" class="most-viewed-mobile"></div>
    </main>
  </div>

  <script>
  window.addEventListener('DOMContentLoaded', () => {
    const firebaseConfig = {
      apiKey: "AIzaSyCvQcDPSF9u1mr2RNQClhMEQ1yDZiuLM-M",
      authDomain: "minitinder-f6314.firebaseapp.com",
      projectId: "minitinder-f6314",
      storageBucket: "minitinder-f6314.appspot.com",
      messagingSenderId: "659347167496",
      appId: "1:659347167496:web:a4e76f562ffba1c4bdf4bd"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const folderGrid=document.getElementById("folderGrid");
    const previewList=document.getElementById("previewList");
    const videoSection=document.getElementById("videoSection");
    const sectionTitle=document.getElementById("sectionTitle");
    const mostViewedMobile=document.getElementById("mostViewedMobile");

    function renderHome(docs){
      sectionTitle.textContent = "VIDEOS GRATIS";
      videoSection.innerHTML = ""; mostViewedMobile.innerHTML="";
      folderGrid.style.display = "grid";
      folderGrid.innerHTML = docs.map(doc=>{
        const folder=doc.id, data=doc.data(), videos=data.videos||[];
        const preview=videos[0]?.poster||videos[0]?.url||"";
        return `
          <div class="card" onclick="openFolder('${folder}')">
            ${preview ? `<img class="card-thumb" src="${preview}" loading="lazy"/>` 
                      : `<div style="aspect-ratio:1/1;background:#222"></div>`}
            <div class="card-title">${folder}</div>
          </div>`;
      }).join("");
    }

    async function openFolder(folder){
      const snap=await db.collection("folders").doc(folder).get();
      if (!snap.exists){sectionTitle.textContent=folder;folderGrid.innerHTML="";videoSection.innerHTML="<p>No hay videos</p>";return;}
      sectionTitle.textContent=folder; folderGrid.style.display="none";
      const data=snap.data();
      videoSection.innerHTML=`<div class="grid">${
        data.videos.map((v,i)=>`
          <div class="card" onclick="playVideo('${folder}',${i})">
            <img class="card-thumb" src="${v.poster||v.url}" loading="lazy"/>
            <div class="card-title">Video ${i+1}</div>
          </div>`).join("")
      }</div>`;
    }

    async function playVideo(folder,idx){
      const ref=db.collection("folders").doc(folder),snap=await ref.get(); if(!snap.exists) return;
      const data=snap.data(); const v=data.videos[idx];
      v.views=(v.views||0)+1; data.videos[idx]=v; await ref.update({videos:data.videos});

      sectionTitle.textContent=`‚ñ∂ ${folder}`; folderGrid.style.display="none";

      videoSection.innerHTML=`
        <div class="video-player">
          <video id="videoPlayer" controls autoplay poster="${v.poster||v.url}" 
            controlsList="nodownload" oncontextmenu="return false;">
            <source src="${v.url}" type="video/mp4">
          </video>
          <p>üëÅÔ∏è ${v.views} vistas</p>
          <div id="adContainer"></div>
        </div>`;

      // ‚ÄúLos m√°s vistos‚Äù SOLO m√≥vil
      const sorted=[...data.videos].sort((a,b)=>(b.views||0)-(a.views||0)).slice(0,5);
      mostViewedMobile.innerHTML=`
        <h3>Los m√°s vistos</h3>
        ${sorted.map(mv=>`
          <div class="mv-item" onclick="playVideo('${folder}',${data.videos.indexOf(mv)})">
            <img src="${mv.poster||mv.url}" loading="lazy"/>
            <div class="mv-title">${mv.views||0} vistas</div>
          </div>`).join("")}`;

      const player=document.getElementById("videoPlayer");
      let ads={start:false,mid:false,end:false};
      player.addEventListener("play",()=>{if(!ads.start){ads.start=true;showAd();}});
      player.addEventListener("timeupdate",()=>{if(player.currentTime>=50&&!ads.mid){ads.mid=true;showAd();}});
      player.addEventListener("ended",()=>{if(!ads.end){ads.end=true;showAd();}});
    }

    function showAd(){
      const ad=document.getElementById("adContainer"); if(!ad) return;
      ad.innerHTML=`<script type="text/javascript">
        atOptions={'key':'de13ddc2442e4144561bcec2fa1af174','format':'iframe','height':60,'width':468,'params':{}};</script>
        <script type="text/javascript" src="//leaklitre.com/de13ddc2442e4144561bcec2fa1af174/invoke.js"></script>`;
    }

    function goHome(){db.collection("folders").get().then(s=>renderHome(s.docs));}
    window.openFolder=openFolder;window.playVideo=playVideo;window.goHome=goHome;
    db.collection("folders").onSnapshot(s=>renderHome(s.docs));
  });
  </script>
</body>
</html>
