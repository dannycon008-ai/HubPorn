<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Plataforma de Videos</title>
  <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&display=swap" rel="stylesheet">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:"Segoe UI", Tahoma, sans-serif; background:#121212; color:#fff; display:flex; }

    header { position:fixed; top:0; left:0; right:0; background:#1f1f1f; display:flex;
      justify-content:center; align-items:center; padding:12px 18px; z-index:100; }
    .title{ font-family:"Archivo Black", sans-serif; font-size:2.5rem;
      background:linear-gradient(to right, #ff4444 50%, #ffffff 50%);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
    main{ margin-top:74px; flex:1; display:flex; }
    .sidebar{ width:240px; background:#1f1f1f; padding:14px; height:calc(100vh - 74px);
      position:fixed; top:74px; left:0; overflow-y:auto; border-right:1px solid #222; }
    .content{ margin-left:240px; flex:1; padding:20px; }
    .folder{ margin-bottom:14px; cursor:pointer; }
    .folder h3 {
      color:#ff4444;
      font-size:1rem;
      font-family: "Archivo Black", sans-serif;
    }

    .video-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      padding: 10px;
      justify-content: flex-start;
    }

    .video-card {
      flex: 0 0 auto;
      width: 160px;
      background: #1b1b1b;
      border: 1px solid #242424;
      border-radius: 10px;
      padding: 6px;
    }

    video.preview {
      width: 100%;
      height: 90px;
      object-fit: cover;
    }

    .video-player video#videoPlayer {
      width: 80%;
      max-width: 600px;
      height: auto;
      border-radius: 12px;
      background: #000;
      display: block;
      margin: 0 auto;
    }

    /* üî• Modal anuncios */
    #adModal {
      display:none; 
      position:fixed; 
      top:0; 
      left:0;
      width:100%; 
      height:100%; 
      background:rgba(0,0,0,0.9);
      z-index:999; 
      justify-content:center; 
      align-items:center;
    }
    #adModal iframe {
      width:80%; 
      height:80%; 
      border:none; 
      border-radius:12px;
    }

    /* Botones de reacciones */
    .reactions {
      margin: 15px 0;
      display: flex;
      gap: 15px;
      justify-content: center;
    }

    .reactions button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 12px;
      border: none;
      border-radius: 50px;
      background: #222;
      color: #fff;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
    }

    .reactions button:hover {
      background: #ff4444;
      transform: scale(1.1);
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <h1 class="title">HubPorn</h1>
  </header>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar"></aside>

  <!-- Contenido -->
  <main class="content">
    <div id="videoSection"><p>Selecciona una carpeta para ver sus videos</p></div>
  </main>

  <!-- Modal anuncios -->
  <div id="adModal">
    <iframe id="adFrame" src=""></iframe>
  </div>

  <script>
  // Configuraci√≥n Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCvQcDPSF9u1mr2RNQClhMEQ1yDZiuLM-M",
    authDomain: "minitinder-f6314.firebaseapp.com",
    projectId: "minitinder-f6314",
    storageBucket: "minitinder-f6314.appspot.com",
    messagingSenderId: "659347167496",
    appId: "1:659347167496:web:a4e76f562ffba1c4bdf4bd",
    measurementId: "G-L0E0Y4ZLK6"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const sidebar = document.getElementById("sidebar");
  const videoSection = document.getElementById("videoSection");

  // ‚úÖ Mostrar anuncio en modal
  function showAd(url, videoPlayer, stopAfter=false){
    const modal = document.getElementById("adModal");
    const frame = document.getElementById("adFrame");
    modal.style.display = "flex";
    frame.src = url;
    setTimeout(() => {
      modal.style.display = "none";
      frame.src = "";
      if (!stopAfter) {
        videoPlayer.play(); // solo reanuda si no es el anuncio final
      }
    }, 2000);
  }

  // ‚úÖ Renderizar carpetas
  async function renderSidebar(){
    sidebar.innerHTML = "";
    const snapshot = await db.collection("folders").get();
    snapshot.forEach(doc => {
      const folder = doc.id;
      const item = document.createElement("div");
      item.className = "folder";
      item.innerHTML = `<h3>${folder}</h3>`;
      item.onclick = () => showFolder(folder);
      sidebar.appendChild(item);
    });
  }

  // ‚úÖ Mostrar videos de una carpeta
  async function showFolder(folder){
    const docSnap = await db.collection("folders").doc(folder).get();
    if (!docSnap.exists){
      videoSection.innerHTML = `<h2>${folder}</h2><p>No hay videos aqu√≠ todav√≠a.</p>`;
      return;
    }
    const data = docSnap.data();
    const grid = data.videos.map((v, idx) => `
      <div class="video-card" onclick="playVideo('${folder}', ${idx})">
        <video class="preview" src="${v.url}" muted preload="metadata"></video>
        <div>${v.views} vistas</div>
      </div>
    `).join("");
    videoSection.innerHTML = `<h2>${folder}</h2><div class="video-grid">${grid}</div>`;
  }

  /* -------- REPRODUCIR VIDEO -------- */
  async function playVideo(folder, idx){
    const folderRef = db.collection("folders").doc(folder);
    const docSnap = await folderRef.get();
    if (!docSnap.exists) return;

    const data = docSnap.data();
    const v = data.videos[idx];

    // üìà Aumentar vistas
    v.views++;
    data.videos[idx] = v;
    await folderRef.update({ videos: data.videos });

    // üé¨ Renderizar video + reacciones
    videoSection.innerHTML = `
      <div class="video-player">
        <video id="videoPlayer" controls autoplay>
          <source src="${v.url}" type="video/mp4">
        </video>
        <p id="views">üëÅÔ∏è ${v.views} vistas</p>

        <div class="reactions">
          <button onclick="addReaction('${folder}', ${idx}, 'like')">üëç (<span id="likeCount">${v.reactions.like}</span>)</button>
          <button onclick="addReaction('${folder}', ${idx}, 'dislike')">üëé (<span id="dislikeCount">${v.reactions.dislike}</span>)</button>
        </div>
      </div>

       <div class="side-images right-side">
      <img src="https://earmuffpostnasalrisotto.com/2077288" alt="ad2">
    </div>
  </div>
    `;

    const videoPlayer = document.getElementById("videoPlayer");

    // üîí Bloqueo para que no adelanten
    videoPlayer.addEventListener("seeking", () => {
      if(videoPlayer.currentTime > (videoPlayer.lastTime || 0)){
        videoPlayer.currentTime = videoPlayer.lastTime; 
      }
    });
    videoPlayer.addEventListener("timeupdate", () => {
      videoPlayer.lastTime = videoPlayer.currentTime; 
    });

    /* üì∫ Anuncios */
    let adsShown = { start:false, mid:false, end:false };

    // Al iniciar
    videoPlayer.addEventListener("play", () => {
      if(!adsShown.start){
        videoPlayer.pause();
        adsShown.start = true;
        showAd("https://overplantovervaluetwine.com/2061965", videoPlayer);
      }
    });

    // A los 50s
    videoPlayer.addEventListener("timeupdate", () => {
      if(videoPlayer.currentTime >= 50 && !adsShown.mid){
        adsShown.mid = true;
        videoPlayer.pause();
        showAd("https://overplantovervaluetwine.com/2061965", videoPlayer);
      }
    });

    // Al final ‚Üí no reanuda
    videoPlayer.addEventListener("ended", () => {
      if(!adsShown.end){
        adsShown.end = true;
        showAd("https://overplantovervaluetwine.com/2061965", videoPlayer, true);
      }
    });
  }

  /* -------- REACCIONES -------- */
  async function addReaction(folder, idx, type){
    const folderRef = db.collection("folders").doc(folder);
    const docSnap = await folderRef.get();
    if (!docSnap.exists) return;

    const data = docSnap.data();
    const v = data.videos[idx];

    // üîí Evitar m√∫ltiples reacciones
    if (v.reacted) {
      alert("Ya reaccionaste a este video üëç");
      return;
    }

    v.reactions[type]++;
    v.reacted = true;   // marcar que ya reaccion√≥
    data.videos[idx] = v;

    await folderRef.update({ videos: data.videos });

    // ‚úÖ solo actualizamos el contador en pantalla
    document.getElementById(type + "Count").textContent = v.reactions[type];
  }

  renderSidebar();
</script>

</body>
</html>
