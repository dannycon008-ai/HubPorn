<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
  // Configuraci√≥n de tu app Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCvQcDPSF9u1mr2RNQClhMEQ1yDZiuLM-M",
    authDomain: "minitinder-f6314.firebaseapp.com",
    projectId: "minitinder-f6314",
    storageBucket: "minitinder-f6314.appspot.com",
    messagingSenderId: "659347167496",
    appId: "1:659347167496:web:a4e76f562ffba1c4bdf4bd",
    measurementId: "G-L0E0Y4ZLK6"
  };

  // Inicializar Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Plataforma de Videos</title>
  <style>
    /* === tus estilos tal cual los tienes === */
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="logo-container">
      <h1 class="title">HubPorn</h1>
    </div>
    <nav>
      <button onclick="toggleAdminPanel()">Admin</button>
    </nav>
  </header>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar"></aside>

  <!-- √Årea principal -->
  <main class="content">
    <div id="videoSection">
      <p>Selecciona una carpeta para ver sus videos</p>
    </div>
  </main>

  <!-- Panel admin -->
  <section id="adminPanel" class="hidden">
    <h2>Panel de Admin</h2>
    <input type="text" id="folderName" placeholder="Nombre de carpeta">
    <button onclick="addFolder()">Agregar Carpeta</button>
    <hr>
    <input type="text" id="videoURL" placeholder="URL del video (mp4)">
    <select id="folderSelect"></select>
    <button onclick="addVideo()">Agregar Video</button>
    <hr>
    <h3>Eliminar Carpeta</h3>
    <select id="deleteFolderSelect"></select>
    <button onclick="deleteFolder()">Eliminar Carpeta</button>
    <hr>
    <h3>Eliminar Video</h3>
    <select id="deleteVideoFolderSelect" onchange="populateVideosToDelete()"></select>
    <select id="deleteVideoSelect"></select>
    <button onclick="deleteVideo()">Eliminar Video</button>
  </section>

  <script>
    const sidebar      = document.getElementById("sidebar");
    const videoSection = document.getElementById("videoSection");
    const folderSelect = document.getElementById("folderSelect");

    function toggleAdminPanel(){
      document.getElementById("adminPanel").classList.toggle("hidden");
    }

    /* Crear carpeta */
    function addFolder(){
      const name = document.getElementById("folderName").value.trim();
      if (!name) return;
      db.collection("carpetas").doc(name).set({ videos: [] }).then(() => {
        renderSidebar();
        document.getElementById("folderName").value = "";
      });
    }

    /* Agregar video */
    function addVideo(){
      const url    = document.getElementById("videoURL").value.trim();
      const folder = document.getElementById("folderSelect").value;
      if (!url || !folder) return;

      const videoObj = {
        url,
        views: 0,
        reactions: { like:0, dislike:0, love:0, amazing:0 },
        comments: []
      };

      db.collection("carpetas").doc(folder).update({
        videos: firebase.firestore.FieldValue.arrayUnion(videoObj)
      }).then(() => {
        renderSidebar();
        showFolder(folder);
        document.getElementById("videoURL").value = "";
      });
    }

    /* Render sidebar */
    function renderSidebar(){
      sidebar.innerHTML = "";
      folderSelect.innerHTML = "";
      document.getElementById("deleteFolderSelect").innerHTML = "";
      document.getElementById("deleteVideoFolderSelect").innerHTML = "";

      db.collection("carpetas").get().then(snapshot => {
        snapshot.forEach(doc => {
          const folder = doc.id;
          const data   = doc.data();

          // Sidebar
          const item = document.createElement("div");
          item.className = "folder";
          item.innerHTML = `<h3>${folder}</h3>`;
          item.onclick = () => showFolder(folder, data.videos);
          sidebar.appendChild(item);

          // Selects
          const opt = document.createElement("option");
          opt.value = folder; opt.textContent = folder;
          folderSelect.appendChild(opt);

          const optDel = document.createElement("option");
          optDel.value = folder; optDel.textContent = folder;
          document.getElementById("deleteFolderSelect").appendChild(optDel);

          const optVid = document.createElement("option");
          optVid.value = folder; optVid.textContent = folder;
          document.getElementById("deleteVideoFolderSelect").appendChild(optVid);
        });
      });
    }

    /* Mostrar videos */
    function showFolder(folder, list){
      if (!list || !list.length){
        videoSection.innerHTML = `<h2>${folder}</h2><p>No hay videos.</p>`;
        return;
      }
      const grid = list.map((v, idx) => `
        <div class="video-card" onclick="playVideo('${folder}', ${idx})">
          <video class="preview" src="${v.url}" muted preload="metadata"></video>
          <div class="meta">${v.views} vistas</div>
        </div>
      `).join("");
      videoSection.innerHTML = `<h2>${folder}</h2><div class="video-grid">${grid}</div>`;
    }

    /* Reproducir video */
    function playVideo(folder, idx){
      db.collection("carpetas").doc(folder).get().then(doc => {
        if (!doc.exists) return;
        let videos = doc.data().videos;
        let v = videos[idx];
        v.views++;

        videos[idx] = v;
        db.collection("carpetas").doc(folder).update({ videos });

        videoSection.innerHTML = `
          <div class="video-player">
            <video id="videoPlayer" controls autoplay>
              <source src="${v.url}" type="video/mp4">
            </video>
            <p>üëÅÔ∏è ${v.views} vistas</p>
            <div class="reactions">
              <button onclick="addReaction('${folder}', ${idx}, 'like')">üëç Like (${v.reactions.like})</button>
              <button onclick="addReaction('${folder}', ${idx}, 'dislike')">üëé Dislike (${v.reactions.dislike})</button>
              <button onclick="addReaction('${folder}', ${idx}, 'love')">‚ù§Ô∏è Me Gusta (${v.reactions.love})</button>
              <button onclick="addReaction('${folder}', ${idx}, 'amazing')">üòç Me Encanta (${v.reactions.amazing})</button>
            </div>
            <section class="comments">
              <h2>Comentarios</h2>
              <div id="commentList">${v.comments.map(c => `<p>üí¨ ${c}</p>`).join("")}</div>
              <textarea id="commentInput"></textarea>
              <button onclick="addComment('${folder}', ${idx})">Comentar</button>
            </section>
          </div>
        `;
      });
    }

    /* Reacciones */
    function addReaction(folder, idx, type){
      db.collection("carpetas").doc(folder).get().then(doc => {
        if (!doc.exists) return;
        let videos = doc.data().videos;
        videos[idx].reactions[type]++;
        db.collection("carpetas").doc(folder).update({ videos }).then(() => {
          playVideo(folder, idx);
        });
      });
    }

    /* Comentarios */
    function addComment(folder, idx){
      const text = document.getElementById("commentInput").value.trim();
      if (!text) return;
      db.collection("carpetas").doc(folder).get().then(doc => {
        let videos = doc.data().videos;
        videos[idx].comments.push(text);
        db.collection("carpetas").doc(folder).update({ videos }).then(() => {
          playVideo(folder, idx);
        });
      });
    }

    /* Eliminar carpeta */
    function deleteFolder(){
      const folder = document.getElementById("deleteFolderSelect").value;
      if (!folder) return;
      if (confirm("¬øEliminar carpeta?")) {
        db.collection("carpetas").doc(folder).delete().then(renderSidebar);
      }
    }

    /* Cargar videos en select eliminar */
    function populateVideosToDelete(){
      const folder = document.getElementById("deleteVideoFolderSelect").value;
      const videoSelect = document.getElementById("deleteVideoSelect");
      videoSelect.innerHTML = "";

      db.collection("carpetas").doc(folder).get().then(doc => {
        if (!doc.exists) return;
        doc.data().videos.forEach((v, idx) => {
          const opt = document.createElement("option");
          opt.value = idx;
          opt.textContent = `Video ${idx+1} - ${v.url.substring(0,30)}...`;
          videoSelect.appendChild(opt);
        });
      });
    }

    /* Eliminar video */
    function deleteVideo(){
      const folder = document.getElementById("deleteVideoFolderSelect").value;
      const idx = document.getElementById("deleteVideoSelect").value;
      if (!folder || idx === "") return;

      db.collection("carpetas").doc(folder).get().then(doc => {
        let videos = doc.data().videos;
        videos.splice(idx, 1);
        db.collection("carpetas").doc(folder).update({ videos }).then(() => {
          renderSidebar();
          showFolder(folder, videos);
        });
      });
    }

    /* Init */
    renderSidebar();
  </script>
</body>
</html>
