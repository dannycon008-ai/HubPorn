<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Plataforma de Videos</title>
  <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&display=swap" rel="stylesheet">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:"Segoe UI", Tahoma, sans-serif; background:#121212; color:#fff; display:flex; }

    header { position:fixed; top:0; left:0; right:0; background:#1f1f1f; display:flex;
      justify-content:center; align-items:center; padding:12px 18px; z-index:100; }
    .title{ font-family:"Archivo Black", sans-serif; font-size:2.5rem;
      background:linear-gradient(to right, #ff4444 50%, #ffffff 50%);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
    main{ margin-top:74px; flex:1; display:flex; }
    .sidebar{ width:240px; background:#1f1f1f; padding:14px; height:calc(100vh - 74px);
      position:fixed; top:74px; left:0; overflow-y:auto; border-right:1px solid #222; }
    .content{ margin-left:240px; flex:1; padding:20px; }
    .folder{ margin-bottom:14px; cursor:pointer; }
    .folder h3{ color:#ff4444; font-size:1rem; }
    
    .video-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      padding: 10px;
      justify-content: flex-start;
    }
    .video-card {
      flex: 0 0 auto;
      width: 160px;
      background: #1b1b1b;
      border: 1px solid #242424;
      border-radius: 10px;
      padding: 6px;
    }
    video.preview {
      width: 100%;
      height: 90px;
      object-fit: cover;
    }
    .video-player video#videoPlayer {
      width: 60%;
      max-width: 600px;
      height: auto;
      border-radius: 12px;
      background:#000;
      display: block;
      margin: 0 auto;
    }

    .reactions button{ background:#222; border:none; padding:8px 12px; border-radius:6px; color:#fff; cursor:pointer; }
    .reactions button:hover{ background:#ff4444; }
    .comments{ margin-top:20px; background:#1f1f1f; padding:15px; border-radius:10px; }
    .comments textarea{ width:100%; height:60px; margin-top:10px; border-radius:8px; padding:8px; border:none; background:#222; color:#fff; }
    .comments button{ margin-top:8px; background:#222; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; }
    .comments button:hover{ background:#ff4444; }

    /* Responsive */
    @media (max-width: 900px) {
      header { flex-direction: column; }
      .sidebar { position:relative; width:100%; height:auto; border-right:none; }
      .content { margin-left:0; }
      .video-player video#videoPlayer { max-width:100%; }
    }
    @media (max-width: 600px) {
      .title { font-size: 1.8rem; }
      .video-grid { flex-direction: column; gap: 16px; }
      .video-card { width:100%; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <h1 class="title">HubPorn</h1>
  </header>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar"></aside>

  <!-- Contenido -->
  <main class="content">
    <div id="videoSection"><p>Selecciona una carpeta para ver sus videos</p></div>
  </main>

  <script>
    // Configuraci√≥n Firebase
    const firebaseConfig = {
      apiKey: "TU_API_KEY",
      authDomain: "TU_AUTH_DOMAIN",
      projectId: "TU_PROJECT_ID",
      storageBucket: "TU_STORAGE_BUCKET",
      messagingSenderId: "TU_MSG_ID",
      appId: "TU_APP_ID",
      measurementId: "TU_MEASURE_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const sidebar = document.getElementById("sidebar");
    const videoSection = document.getElementById("videoSection");

    /* -------- RENDER SIDEBAR -------- */
    async function renderSidebar(){
      sidebar.innerHTML = "";
      const snapshot = await db.collection("folders").get();
      snapshot.forEach(doc => {
        const folder = doc.id;
        const item = document.createElement("div");
        item.className = "folder";
        item.innerHTML = `<h3>${folder}</h3>`;
        item.onclick = () => showFolder(folder);
        sidebar.appendChild(item);
      });
    }

    /* -------- MOSTRAR VIDEOS -------- */
    async function showFolder(folder){
      const folderRef = db.collection("folders").doc(folder);
      const docSnap = await folderRef.get();
      if (!docSnap.exists){
        videoSection.innerHTML = `<h2>${folder}</h2><p>No hay videos aqu√≠ todav√≠a.</p>`;
        return;
      }
      const data = docSnap.data();
      const grid = data.videos.map((v, idx) => `
        <div class="video-card" onclick="playVideo('${folder}', ${idx})">
          <video class="preview" src="${v.url}" muted preload="metadata"></video>
          <div>${v.views} vistas</div>
        </div>
      `).join("");
      videoSection.innerHTML = `<h2>${folder}</h2><div class="video-grid">${grid}</div>`;
    }

    /* -------- REPRODUCIR VIDEO -------- */
    async function playVideo(folder, idx){
      const folderRef = db.collection("folders").doc(folder);
      const docSnap = await folderRef.get();
      if (!docSnap.exists) return;
      const data = docSnap.data();
      const v = data.videos[idx];

      v.views++;
      data.videos[idx] = v;
      await folderRef.update({ videos: data.videos });

      videoSection.innerHTML = `
        <div class="video-player">
          <video id="videoPlayer" controls autoplay>
            <source src="${v.url}" type="video/mp4">
          </video>
          <p>üëÅÔ∏è ${v.views} vistas</p>
        </div>
      `;
    }

    renderSidebar();
  </script>
</body>
</html>
